<!DOCTYPE html>
<html>
<head>
  <title>Air Quality Table</title>
  <style>
    table {
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
      border: 1px solid black;
    }
  </style>
</head>
<body>
  <h1 id="tableTitle">Predicted Daily AQI Maximums for</h1>
  <table id="airQualityTable">
    <thead>
      <tr>
        <th>Town</th>
        <th>Fine Particles (PM2.5)</th>
        <th>Ozone (O3)</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script>
    // AirNow API URL and parameters
    const apiUrl = 'https://www.airnowapi.org/aq/forecast/latLong/';
    const apiKey = '860173AA-E019-4D82-9A97-FA4630A41597'; // Replace with your AirNow API key

    // Function to format date as "Day, Month DD, YYYY"
    function formatDate(date) {
      const options = { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' };
      return date.toLocaleDateString(undefined, options);
    }

// Function to fetch data from AirNow API and update the table
function updateAirQualityTable() {
  const today = new Date();
  const formattedDate = today.toISOString().slice(0, 10);
  document.getElementById('tableTitle').textContent = `Predicted Daily AQI Maximums for ${formattedDate}`;

  const townData = [
    { town: 'Bridgeport, CT', latitude: 41.184, longitude: -73.19 },
    { town: 'Cornwall, CT', latitude: 41.8634, longitude: -73.3382 }
    // Add more towns if needed
  ];

  const tableBody = document.getElementById('tableBody');
  tableBody.innerHTML = '';

  townData.forEach(town => {
    fetch(`${apiUrl}?format=application/json&latitude=${town.latitude}&longitude=${town.longitude}&date=${formattedDate}&distance=25&API_KEY=${apiKey}`)
      .then(response => response.json())
      .then(data => {
        let pm25Aqi = 'NA';
        let o3Aqi = 'NA';

        if (data.length > 0) {
          data.forEach(forecast => {
            const forecastDate = forecast.DateForecast.trim(); // Trim any extra whitespace
            if (forecast.ParameterName === 'PM2.5' && forecastDate === formattedDate) {
              pm25Aqi = forecast.AQI;
            } else if (forecast.ParameterName === 'O3' && forecastDate === formattedDate) {
              o3Aqi = forecast.AQI;
            }
          });
        }

        const row = document.createElement('tr');
        const townCell = document.createElement('td');
        townCell.textContent = town.town;
        const pm25Cell = document.createElement('td');
        pm25Cell.textContent = pm25Aqi;
        const o3Cell = document.createElement('td');
        o3Cell.textContent = o3Aqi;

        row.appendChild(townCell);
        row.appendChild(pm25Cell);
        row.appendChild(o3Cell);
        tableBody.appendChild(row);
      })
      .catch(error => {
        console.log(`Error fetching air quality data for ${town.town}:`, error);
      });
  });
}

    // Initial table update
    updateAirQualityTable();

    // Periodic table updates every 5 minutes (300000 milliseconds)
    setInterval(updateAirQualityTable, 300000);
  </script>
</body>
</html>
